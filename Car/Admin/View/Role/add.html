<!--引入日历插件样式 -->
<link href="{$Think.config.ADMIN_CSS_URL}jquery.datetimepicker.css" rel="stylesheet" type="text/css" />


            <!-- BEGIN CONTENT -->
            <style type="text/css">
<!--
.md-checkbox label>.box {
    top: 15px;
    left: 15px;
    border: 2px solid #666;
    height: 20px;
    width: 20px;
    z-index: 5;
    -webkit-transition-delay: .2s;
    -moz-transition-delay: .2s;
    transition-delay: .2s;
}
.md-checkbox label>.check {
    top: 10px;
    left: 15px;
    width: 10px;
    height: 20px;
    border: 2px solid #36c6d3;
    border-top: none;
    border-left: none;
    opacity: 0;
    z-index: 5;
    -webkit-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    transform: rotate(180deg);
    -webkit-transition-delay: .3s;
    -moz-transition-delay: .3s;
    transition-delay: .3s;
}
-->
</style><div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEAD-->
                    <div class="page-head">
                        <!-- BEGIN PAGE TITLE -->
                        <div class="page-title">
                            <h1>添加用户角色
                                <small>在此你可以根据需求进行添加对应的角色，同时分配不同的权限</small>
                            </h1>
                        </div>
                        <!-- END PAGE TITLE -->
                        <!-- BEGIN PAGE TOOLBAR -->
                        <!--<div class="page-toolbar">-->
                            <!--&lt;!&ndash; BEGIN THEME PANEL &ndash;&gt;-->
                            <!--<div class="btn-group btn-theme-panel">-->
                                <!--<a href="javascript:;" class="btn dropdown-toggle" data-toggle="dropdown">-->
                                    <!--<i class="icon-settings"></i>-->
                                <!--</a>-->
                                <!--<div class="dropdown-menu theme-panel pull-right dropdown-custom hold-on-click">-->
                                    <!--<div class="row">-->
                                        <!--<div class="col-md-4 col-sm-4 col-xs-12">-->
                                            <!--<h3>HEADER</h3>-->
                                            <!--<ul class="theme-colors">-->
                                                <!--<li class="theme-color theme-color-default active" data-theme="default">-->
                                                    <!--<span class="theme-color-view"></span>-->
                                                    <!--<span class="theme-color-name">Dark Header</span>-->
                                                <!--</li>-->
                                                <!--<li class="theme-color theme-color-light " data-theme="light">-->
                                                    <!--<span class="theme-color-view"></span>-->
                                                    <!--<span class="theme-color-name">Light Header</span>-->
                                                <!--</li>-->
                                            <!--</ul>-->
                                        <!--</div>-->
                                        <!--<div class="col-md-8 col-sm-8 col-xs-12 seperator">-->
                                            <!--<h3>LAYOUT</h3>-->
                                            <!--<ul class="theme-settings">-->
                                                <!--<li> Theme Style-->
                                                    <!--<select class="layout-style-option form-control input-small input-sm">-->
                                                        <!--<option value="square">Square corners</option>-->
                                                        <!--<option value="rounded" selected="selected">Rounded corners</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                                <!--<li> Layout-->
                                                    <!--<select class="layout-option form-control input-small input-sm">-->
                                                        <!--<option value="fluid" selected="selected">Fluid</option>-->
                                                        <!--<option value="boxed">Boxed</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                                <!--<li> Header-->
                                                    <!--<select class="page-header-option form-control input-small input-sm">-->
                                                        <!--<option value="fixed" selected="selected">Fixed</option>-->
                                                        <!--<option value="default">Default</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                                <!--<li> Top Dropdowns-->
                                                    <!--<select class="page-header-top-dropdown-style-option form-control input-small input-sm">-->
                                                        <!--<option value="light">Light</option>-->
                                                        <!--<option value="dark" selected="selected">Dark</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                                <!--<li> Sidebar Mode-->
                                                    <!--<select class="sidebar-option form-control input-small input-sm">-->
                                                        <!--<option value="fixed">Fixed</option>-->
                                                        <!--<option value="default" selected="selected">Default</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                                <!--<li> Sidebar Menu-->
                                                    <!--<select class="sidebar-menu-option form-control input-small input-sm">-->
                                                        <!--<option value="accordion" selected="selected">Accordion</option>-->
                                                        <!--<option value="hover">Hover</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                                <!--<li> Sidebar Position-->
                                                    <!--<select class="sidebar-pos-option form-control input-small input-sm">-->
                                                        <!--<option value="left" selected="selected">Left</option>-->
                                                        <!--<option value="right">Right</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                                <!--<li> Footer-->
                                                    <!--<select class="page-footer-option form-control input-small input-sm">-->
                                                        <!--<option value="fixed">Fixed</option>-->
                                                        <!--<option value="default" selected="selected">Default</option>-->
                                                    <!--</select>-->
                                                <!--</li>-->
                                            <!--</ul>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                            <!--&lt;!&ndash; END THEME PANEL &ndash;&gt;-->
                        <!--</div>-->
                        <!-- END PAGE TOOLBAR -->
                    </div>
                    <!-- END PAGE HEAD-->
                    <!-- BEGIN PAGE BREADCRUMB -->
                    <ul class="page-breadcrumb breadcrumb">
                        <li>
                            <a href="#">组织架构管理</a>
                            <i class="fa fa-circle"></i>
                        </li>
						<li>
                            <a href="#">角色管理</a>
                            <i class="fa fa-circle"></i>
                        </li>
                        <li>
                            <span class="active">添加用户角色</span>
                        </li>
                    </ul>
                    <!-- END PAGE BREADCRUMB -->
                    <!-- BEGIN PAGE BASE CONTENT -->
                    <form action="#" method="post" class="form-horizontal" id="form_sample_1">
                        <input type="hidden" name="role_auth_ids[]" value="" id="check_n"/>
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN VALIDATION STATES-->
                            <div class="portlet light portlet-fit portlet-form bordered">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class=" icon-layers font-green"></i>
                                        <span class="caption-subject font-green sbold uppercase">菜单及显示权限</span>
                                    </div>
                                    <div class="actions">
                                        <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                            <i class="icon-cloud-upload"></i>
                                        </a>
                                        <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                            <i class="icon-wrench"></i>
                                        </a>
                                        <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                            <i class="icon-trash"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <!-- BEGIN FORM-->

                                        <div class="form-body">
                                            <div class="alert alert-danger display-hide">
                                                <button class="close" data-close="alert"></button> 您填写的信息可能存在问题，请再检查 </div>
                                            <div class="alert alert-success display-hide">
                                                <button class="close" data-close="alert"></button> 添加成功，请查看记录列表 </div>
                                            <div class="form-group form-md-line-input">
                                                <label class="col-md-2 control-label" for="form_control_1">角色名称
                                                    <span class="required">*</span>
                                                </label>
                                                <div class="col-md-9">
                                                    <input type="text" class="form-control" placeholder="" name="role_name">
                                                    <div class="form-control-focus"> </div>
                                                    <span class="help-block">请输入角色名称</span>
                                                </div>
                                            </div>
                                            <div class="form-group form-md-checkboxes">
                                                <label class="col-md-2 control-label" for="form_control_1">用户权限</label>
                                                <div class="col-md-9"><table border='1' style="border:1px  #c2cad8 solid; width:100%;">
                                                    <foreach name="auth_infosA" item="v">
                                                        <tr>
                                                            <td width="20%;">
                                                                <div class="md-checkbox" style="float: left; padding:15px 15px 15px 20px;">
                                                                    <input type="checkbox" id="checkbox1_{$v.id}" name="role_auth_ids[]" value="{$v.id}" class="md-check" onclick="parent_controller(this)">
                                                                            <label for="checkbox1_{$v.id}">
                                                                                <span></span>
                                                                                <span class="check"></span>
                                                                                <span class="box"></span> {$v.name} </label>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <foreach name="auth_infosB" item="vv">
                                                                    <if condition="$vv['fid'] eq $v['id']">
                                                                        <div class="md-checkbox" style="float: left; padding:15px 15px 15px 20px;">
                                                                            <input type="checkbox" id="checkbox1_{$vv.id}" name="role_auth_ids[]" value="{$vv.id}" class="md-check" onclick="check_parent(this)">
                                                                            <label for="checkbox1_{$vv.id}">
                                                                                <span></span>
                                                                                <span class="check"></span>
                                                                                <span class="box"></span> {$vv.name} </label>
                                                                            <if condition="$vv['is_child'] eq 1">
                                                                                <i class="fa fa-plus" onclick="show_child_list(this)"></i>
                                                                            </if>
                                                                        </div>
                                                                    </if>
                                                                </foreach>
                                                            </td>
                                                        </tr>
                                                    </foreach>
                                                    <tr>
                                                        <td width="20%;">
                                                            <div class="md-checkbox" style="float: left; padding:15px 15px 15px 20px;">
                                                                <input type="checkbox" id="checkbox2_{$v.id}"  class="md-check" onclick="parent_controller(this)">
                                                                <label for="checkbox2_{$v.id}">
                                                                    <span></span>
                                                                    <span class="check"></span>
                                                                    <span class="box"></span> 首页逻辑权限 </label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <foreach name="auth_infosC" item="vo">
                                                                    <div class="md-checkbox" style="float: left; padding:15px 15px 15px 20px;">
                                                                        <input type="checkbox" id="checkbox2_{$vo.id}" name="role_auth_ids[]" value="{$vo.id}" class="md-check" onclick="check_parent(this)">
                                                                        <label for="checkbox2_{$vo.id}">
                                                                            <span></span>
                                                                            <span class="check"></span>
                                                                            <span class="box"></span> {$vo.name} </label>
                                                                    </div>
                                                            </foreach>
                                                        </td>
                                                    </tr>
                                                </table></div>
                                            </div>
                                            
                                            
                                        </div>
                                        <div class="form-actions">
                                            <div class="row">
                                                <div class="col-md-offset-2 col-md-9">
                                                    <button type="submit" class="btn green">确认提交</button>
                                                    <button type="reset" class="btn default" onclick="window.location.href='http://www.hdhsmart.com/Car/index.php?s=/Admin/Role/showlist.html'">返 回</button>
                                                </div>
                                            </div>
                                        </div>

                                    <!-- END FORM-->
                                </div>
                            </div>
                            <!-- END VALIDATION STATES-->
                        </div>
                        <div class="col-md-6" id="role_hide" style="display: none;">
                            <!-- BEGIN VALIDATION STATES-->
                            <div class="portlet light portlet-fit portlet-form bordered">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class=" icon-layers font-green"></i>
                                        <span class="caption-subject font-green sbold uppercase">业务逻辑权限</span>
                                    </div>
                                    <div class="actions">
                                        <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                            <i class="icon-cloud-upload"></i>
                                        </a>
                                        <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                            <i class="icon-wrench"></i>
                                        </a>
                                        <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                            <i class="icon-trash"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <!-- BEGIN FORM-->

                                        <div class="form-body">
                                            <div class="alert alert-danger display-hide">
                                                <button class="close" data-close="alert"></button> 您填写的信息可能存在问题，请再检查 </div>
                                            <div class="alert alert-success display-hide">
                                                <button class="close" data-close="alert"></button> 添加成功，请查看记录列表 </div>
                                            <div class="form-group form-md-checkboxes">
                                                <label class="col-md-3 control-label" for="form_control_1">用户权限</label>
                                                <table border='1' id="my_box" style="border:1px  #c2cad8 solid; width:100%;">
                                                    <foreach name="auth_infosA" item="v">
                                                        <tr>
                                                            <td>
                                                                <div class="md-checkbox" style="width: 110px; float: left;">
                                                                    <input type="checkbox" id="checkbox2_{$v.id}" name="role_auth_ids[]" value="{$v.id}" class="md-check" onclick="parent_controller(this)">
                                                                    <label for="checkbox1_{$v.auth_id}">
                                                                        <span></span>
                                                                        <span class="check"></span>
                                                                        <span class="box"></span> {$v.name} </label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </foreach>
                                                </table>
                                            </div>


                                        </div>

                                    <!-- END FORM-->
                                </div>
                            </div>
                            <!-- END VALIDATION STATES-->
                        </div>
                    </div>
                    

                </form>
            </div>
            <!-- END QUICK SIDEBAR -->
        </div>
        <!-- END CONTAINER -->
        <!-- BEGIN FOOTER -->
        <div class="page-footer">
            <div class="page-footer-inner"> 2017 &copy; 汇得行智慧停车系统
                <a target="_blank" href="http://www.vhi99.com">邻钱科技</a> &nbsp;|&nbsp;
                <a href="http://www.metronic.com" target="_blank">Metronic</a>
            </div>
            <div class="scroll-to-top">
                <i class="icon-arrow-up"></i>
            </div>
        </div>
        <!-- END FOOTER -->
        <!-- BEGIN QUICK NAV -->
        <!--<nav class="quick-nav">-->
            <!--<a class="quick-nav-trigger" href="#0">-->
                <!--<span aria-hidden="true"></span>-->
            <!--</a>-->
            <!--<ul>-->
                <!--<li>-->
                    <!--<a href="https://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes" target="_blank" class="active">-->
                        <!--<span>Purchase Metronic</span>-->
                        <!--<i class="icon-basket"></i>-->
                    <!--</a>-->
                <!--</li>-->
                <!--<li>-->
                    <!--<a href="https://themeforest.net/item/metronic-responsive-admin-dashboard-template/reviews/4021469?ref=keenthemes" target="_blank">-->
                        <!--<span>Customer Reviews</span>-->
                        <!--<i class="icon-users"></i>-->
                    <!--</a>-->
                <!--</li>-->
                <!--<li>-->
                    <!--<a href="http://keenthemes.com/showcast/" target="_blank">-->
                        <!--<span>Showcase</span>-->
                        <!--<i class="icon-user"></i>-->
                    <!--</a>-->
                <!--</li>-->
                <!--<li>-->
                    <!--<a href="http://keenthemes.com/metronic-theme/changelog/" target="_blank">-->
                        <!--<span>Changelog</span>-->
                        <!--<i class="icon-graph"></i>-->
                    <!--</a>-->
                <!--</li>-->
            <!--</ul>-->
            <!--<span aria-hidden="true" class="quick-nav-bg"></span>-->
        <!--</nav>-->
        <div class="quick-nav-overlay"></div>
        <!-- END QUICK NAV -->
        <!--[if lt IE 9]>
<script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/respond.min.js"></script>
<script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/excanvas.min.js"></script> 
<script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/ie8.fix.min.js"></script> 
<![endif]-->
        <!-- BEGIN CORE PLUGINS -->
        <script src="{$Think.config.ADMIN_JS_URL}jquery.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/jquery.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/js.cookie.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
        <!-- END CORE PLUGINS -->
        <!-- BEGIN PAGE LEVEL PLUGINS -->
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
        <!-- END PAGE LEVEL PLUGINS -->
        <!-- BEGIN THEME GLOBAL SCRIPTS -->
        <script src="{$Think.config.ADMIN_ASSETS_URL}global/scripts/app.min.js" type="text/javascript"></script>
        <!-- END THEME GLOBAL SCRIPTS -->
        <!-- BEGIN PAGE LEVEL SCRIPTS -->
        <!--表单提交检查js-->
        <!--<script src="{$Think.config.ADMIN_ASSETS_URL}pages/scripts/form-validation-md.min.js" type="text/javascript"></script>-->
        <!-- END PAGE LEVEL SCRIPTS -->
        <!-- BEGIN THEME LAYOUT SCRIPTS -->
        <script src="{$Think.config.ADMIN_ASSETS_URL}layouts/layout4/scripts/layout.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}layouts/layout4/scripts/demo.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_ASSETS_URL}layouts/global/scripts/quick-nav.min.js" type="text/javascript"></script>
        <!-- END THEME LAYOUT SCRIPTS -->
        <!--引入日历jquery插件开始-->
        <!--
        <script src="{$Think.config.ADMIN_JS_URL}jquery.datetimepicker.js" type="text/javascript"></script>
        <script src="{$Think.config.ADMIN_JS_URL}jquery.datetimepicker.min.js" type="text/javascript"></script>-->
        
        <script src="{$Think.config.ADMIN_JS_URL}jquery.datetimepicker.full.js" type="text/javascript"></script>
        <!--引入日历jquery插件结束-->
        
        <script type='text/javascript'>
            //开启日历插件
            $('#datetimepicker').datetimepicker({
                lang:"ch",           //语言选择中文
                format:"Y-m-d H:i:s",      //格式化日期
                timepicker:false,    //关闭时间选项
                yearStart:2000,     //设置最小年份
                yearEnd:2050,        //设置最大年份
                todayButton:false    //关闭选择今天按钮
            });
            $('#datetimepicker2').datetimepicker({
                lang:"ch",           //语言选择中文
                format:"Y-m-d H:i:s",      //格式化日期
                timepicker:false,    //关闭时间选项
                yearStart:2000,     //设置最小年份
                yearEnd:2050,        //设置最大年份
                todayButton:false    //关闭选择今天按钮
            });
            
            
            //当一级权限被选中或者取消时，判断其它同级权限从而判断顶级全选的被选状态
            var auth_a_satat=0;
            function check_parent(obj){
                //将所选的值传给ajax
                /*var menu_id = $(obj).val();
                $.ajax({
                    url:"{:U('Role/make_child_html')}",
                    data:{'menu_id':menu_id},
                    type:'post',
                    success:function(res){
                        $("#my_box").html(res);
                        $("#role_hide").show();
                    }
                });*/
                var its_length=$(obj).parent().parent().find('input').length;
                $(obj).parent().parent().find('input').each(function(k,v){
                    if( $(v).prop('checked') ){
                        auth_a_satat++;
                    }else{
                        auth_a_satat--;
                    }
                });
                if(auth_a_satat>(-its_length)){
                    $(obj).parent().parent().parent().find('input').first().prop('checked','checked');
                }else{
                    $(obj).parent().parent().parent().find('input').first().removeAttr('checked');
                }
                auth_a_satat=0;
            }
            
            //当顶级权限被点中时一级权限被全部选择，否则全部不选
            function parent_controller(obj){
                if( $(obj).prop('checked') ){
                    $(obj).parent().parent().next().find('input').each(function(k,v){
                        $(v).prop('checked','checked');
                    });
                }else{
                    $(obj).parent().parent().next().find('input').each(function(k,v){
                        $(v).removeAttr('checked');
                    });
                }
            }

            function get_check_n(obj){
                var check_n = $(obj).val();
                //alert(check_n);
                $("#check_n").val(check_n);
            }

            //将当前栏目下的逻辑业务显示出来
            function show_child_list(obj){
                //从后台拉取子栏目的所有业务权限显示在下面
                var menu_id = $(obj).prev().prev().val();
                $.ajax({
                    url:"{:U('Role/make_child_html')}",
                    data:{'menu_id':menu_id},
                    type:'post',
                    success:function(res){
                        $(obj).parent().parent().parent().after(res);
                        $(obj).fadeOut(100);
                    }
                });
            }
            
        </script>
    </body>

</html>