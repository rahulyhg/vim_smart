<?phpclass House_village_repair_listModel extends Model{    /**     * get_list 改     * @param $map 条件 可以使用 house_village_repair_list 任何字段作为条件     * @param int $sizePage 分页行数     * @update-time: 2017-06-08 15:45:19     * @author: 王亚雄     */	public function getlist($map,$sizePage=20){	    //加载分页类        import('@.ORG.merchant_page');        //条件处理        $map = $map?:array();        $tmp = array();        foreach($map as $k=>$v){            $tmp['r.' . $k] = $v;        }        $map = $tmp;        //字段        $field = array(           'r.pigcms_id as pid,r.*,b.*'        );        //总条数        $count = $this->alias('r')            ->join('JOIN __HOUSE_VILLAGE_USER_BIND__ b on r.village_id = b.village_id  AND r.bind_id = b.pigcms_id')            ->where($map)            ->count();        //分页        $page =  new Page($count,$sizePage,'page');        //当前页数据        $list = $this->alias('r')            ->join('JOIN __HOUSE_VILLAGE_USER_BIND__ b on r.village_id = b.village_id  AND r.bind_id = b.pigcms_id')            ->field($field)            ->where($map)            ->limit($page->firstRow,$page->listRows)            ->order('r.pigcms_id DESC,r.is_read ASC')            ->select();        //数据处理参照原先的        if($list){            foreach ($list as $k=>$v){                if($v['pic']){                    $pic = explode('|', $v['pic']);                    $picArray = array();                    foreach ($pic as $picinfo){                        if(strpos($picinfo,'upload/adver')>-1){                            $picArray[] = C('config.site_url').$picinfo;                        }else{                            $picArray[] = C('config.site_url')."/upload/house/".$picinfo;                        }                    }                    $list[$k]['pic'] = $picArray;                }            }            $return['pagebar'] = $page->show();//页码栏            $return['totalPage'] = $page->totalPage;            $return['totalRows'] = $count;            $return['repair_list'] = $list;            return $return;        }    }	public function getlist_bak($column,$sizePage=20){		if(!$column['village_id']){			return '';		}		$condition_table  = array(C('DB_PREFIX').'house_village_repair_list'=>'r',C('DB_PREFIX').'house_village_user_bind'=>'b');		$condition_where = " r.village_id = b.village_id  AND r.bind_id = b.pigcms_id  AND r.village_id=".$column['village_id'];		if($column['type']){			$condition_where .= " AND r.type = ".$column['type'];		}		if($column['bind_id']){			$condition_where .= " AND r.bind_id = ".intval($column['bind_id']);		}				$condition_field = 'r.pigcms_id as pid,r.*,b.*';		if($column['pigcms_id']){			$condition_where .= " AND r.pigcms_id = ".intval($column['pigcms_id']);		}		$order = ' r.pigcms_id DESC,r.is_read ASC ';		import('@.ORG.merchant_page');		$count_repair = D('')->table($condition_table)->where($condition_where)->count();		$p = new Page($count_repair,$sizePage,'page');		$repair_list = D('')->field($condition_field)->table($condition_table)->where($condition_where)->order($order)->limit($p->firstRow.','.$p->listRows)->select();		$return = array();		if($repair_list){			foreach ($repair_list as $k=>$v){				if($v['pic']){					$pic = explode('|', $v['pic']);					$picArray = array();					foreach ($pic as $picinfo){						$picArray[] = C('config.site_url')."/upload/house/".$picinfo;					}					$repair_list[$k]['pic'] = $picArray;				}			}			$return['pagebar'] = $p->show();			$return['repair_list'] = $repair_list;		}				return $return;	}		 }